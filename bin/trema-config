#! /usr/bin/env ruby
#
# Trema compile helper.
#
# Copyright (C) 2008-2013 NEC Corporation
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License, version 2, as
# published by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#

$LOAD_PATH.unshift(File.expand_path(File.dirname(__FILE__) + '/../ruby'))

require 'optparse'
require 'trema/path'

module Trema
  # Trema gcc helper.
  class TremaConfig
    def initialize(argv = ARGV)
      @argv = argv.dup
      @flag = {}
      @option = OptionParser.new
      define_commandline_options
    end

    def run
      parse_argv
      show_gcc_options
    end

    private

    def define_commandline_options
      @option.banner = "Usage: #{File.basename $PROGRAM_NAME} [OPTIONS ...]"
      @option.on('-c', '--cflags') do
        @flag[:cflags] = true
      end
      @option.on('-l', '--libs') do
        @flag[:libs] = true
      end
    end

    def parse_argv
      @option.parse! @argv
    end

    def show_gcc_options
      out = []
      out << "-I#{Trema.source}/src/lib -I#{Trema.openflow}" if @flag[:cflags]
      out << "-L#{Trema.objects}/lib #{libraries.join ' '}" if @flag[:libs]
      print out.join(' ')
    end

    def libraries
      %w(trema rt pthread sqlite3 dl).map do |each|
        "-l#{each}"
      end
    end
  end
end

Trema::TremaConfig.new.run

### Local variables:
### mode: Ruby
### coding: utf-8
### indent-tabs-mode: nil
### End:
